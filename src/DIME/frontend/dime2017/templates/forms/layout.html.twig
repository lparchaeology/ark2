{% use "bootstrap_3_horizontal_layout.html.twig" %}

{# Override standard blocks #}

{% block form_label_class -%}
col-xs-12 col-sm-4
{%- endblock form_label_class %}

{# Fix nested blank labels, see https://github.com/symfony/symfony/pull/19247 #}
{% block form_label -%}
    {% spaceless %}
        {% if label is not same as(false) %}
            {% set label_attr = label_attr|merge({class: (label_attr.class|default('') ~ ' ' ~ block('form_label_class'))|trim}) %}
            {{- parent() -}}
        {% endif %}
    {% endspaceless %}
{%- endblock form_label %}

{# Fix nested blank labels, see https://github.com/symfony/symfony/pull/19247 #}
{% block form_group_class -%}
    {%- if label is same as(false) -%}
        col-sm-11
    {%- else -%}
        form-group-widget col-xs-11 col-sm-7 col-lg-7
    {%- endif -%}
{%- endblock form_group_class %}

{% block form_widget -%}
    {{ parent() }}
    {% if help is defined and help is not null and state.modus is defined and state.modus == 'active' %}
        <span class="help" title="{{ help | translate }}" data-toggle="tooltip" data-placement="right" >
            <span class="glyphicon glyphicon-question-sign">
            </span>
        </span>
    {% endif %}
{%- endblock form_widget %}

{# Custom blocks #}

{% block property_widget -%}
    {% for key, subform in form %}
        {{- form_widget(subform, {'state': state, 'help': help}) -}}
        {% do subform.setRendered %}
    {% endfor %}
{%- endblock property_widget %}

{% block static_widget -%}
    {% spaceless %}
    <div id="{{ id }}" class="static-widget" >
        {% if value is empty %}
            &nbsp;
        {% elseif value is iterable %}
            {% set out = '' %}
            {% set sep = '' %}
            {% for val in value %}
                {% set out = out ~ sep ~ val|translate %}
                {% set sep = '<br />' %}
            {% endfor %}
            {{ out|raw }}
        {% else %}
            {{ value|translate }}
        {% endif %}
    </div>
    {% endspaceless %}
{%- endblock static_widget %}

{% block unit_widget -%}
    <div class="input-group">
        {{- form_widget(form['value']) -}}
        <div class="input-group-addon"> {{- form['unit'].vars['data'] -}} </div>
    </div>
    {% do form.setRendered %}
{%- endblock unit_widget %}

{% block checkbox_widget %}
    {% spaceless %}
        <div class="checkbox">
            <input type="checkbox" {{ block('widget_attributes') }}{% if value is defined %} value="{{ value }}"{% endif %}{% if checked %} checked="checked"{% endif %} />
            <label for="{{ id }}"><span class="checkboxlabel">{{ label|trans({}, translation_domain) }}</span></label>
        </div>
    {% endspaceless %}
{% endblock checkbox_widget %}

{% block file_widget %}
    {% spaceless %}
     {% set type = type|default('file') %}
     {% set id_array = form.vars.id|split('_') %}
     {% if form.parent.vars.data and form.parent.vars.data.item.property(id_array[1]).value is iterable %}
         <input type="{{ type }}" {{ block('widget_attributes') }} data-existing = "{%- for image in form.parent.vars.data.item.property(id_array[1]).value %}{{ image.id }}{{ loop.last ? '' : ', ' }}{% endfor %}"/>
     {% elseif form.parent.vars.data.item.property(id_array[1]).value.id is defined %}
         <input type="{{ type }}" {{ block('widget_attributes') }} data-existing = "{{ form.parent.vars.data.item.property(id_array[1]).value.id }}"/>
     {% else %}
         <input type="{{ type }}" {{ block('widget_attributes') }} />
     {% endif %}
    {% endspaceless %}
{% endblock file_widget %}
